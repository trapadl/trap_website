import{s as w,i as ne,a as le}from"./countdown-1B-LzVIm.js";import{r as c,R as e,c as R,a as ce,O as ie,b as oe}from"./OrganizerSelect-FMxHs_QS.js";const de=R("AdminTabsNav"),me=({activeTab:t,onTabChange:m})=>{c.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:{user:i}}=await w.auth.getUser();if(!i){window.location.href="/";return}const{data:o,error:h}=await w.from("bartenders").select("is_admin").eq("user_id",i.id).single();(h||!(o!=null&&o.is_admin))&&(window.location.href="/")}catch(i){de.error("Error verifying admin access:",i),window.location.href="/"}},n=[{id:"results",label:"Competition Results",description:"Review and manage competition results"},{id:"bartenders",label:"Bartenders",description:"Manage bartender profiles and rankings"},{id:"organisers",label:"Organisers",description:"Manage competition organisers"},{id:"profile_claims",label:"Profile Claims",description:"Review and manage profile claims"},{id:"glicko_ratings",label:"Glicko Ratings"}];return e.createElement("nav",{className:"flex space-x-1 mb-6 bg-gray-800 p-1 rounded-lg overflow-x-auto",role:"tablist","aria-label":"Admin sections"},n.map(i=>e.createElement("button",{key:i.id,onClick:()=>m(i.id),className:`
            px-4 py-2 rounded-md transition-colors whitespace-nowrap
            ${t===i.id?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700"}
          `,role:"tab","aria-selected":t===i.id,"aria-controls":`${i.id}-panel`,id:`${i.id}-tab`,title:i.description},i.label)))},B=R("AdminActions"),ue=({id:t,isEditing:m,onEdit:g,onSave:n,onCancel:i,onApprove:o,onDeny:h,showApproveButtons:v,disabled:b=!1})=>{const _=()=>{B.debug("Edit action triggered",{id:t}),g==null||g()},d=()=>{B.debug("Save action triggered",{id:t}),n==null||n()},r=()=>{B.debug("Cancel action triggered",{id:t}),i==null||i()},s=()=>{B.info("Approve action triggered",{id:t}),o==null||o()},f=()=>{B.info("Deny action triggered",{id:t}),h==null||h()};return e.createElement("div",{className:"flex gap-2 items-center"},m?e.createElement(e.Fragment,null,e.createElement("button",{onClick:d,disabled:b,className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Save changes"},"Save"),e.createElement("button",{onClick:r,disabled:b,className:"bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Cancel editing"},"Cancel")):e.createElement(e.Fragment,null,e.createElement("button",{onClick:_,disabled:b,className:"bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Edit item"},"Edit"),v&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:s,disabled:b,className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Approve item"},"Approve"),e.createElement("button",{onClick:f,disabled:b,className:"bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Deny item"},"Deny"))))};let I;function ge(){return I||(I=document.createElement("div"),I.className="fixed top-4 right-4 z-50 flex flex-col gap-2",document.body.appendChild(I)),I}function re(t,m="info",g=3e3){const n=ge(),i=document.createElement("div");return i.className=`
    px-4 py-2 rounded shadow-lg text-white
    ${m==="error"?"bg-red-600":""}
    ${m==="success"?"bg-green-600":""}
    ${m==="info"?"bg-blue-600":""}
    ${m==="warning"?"bg-yellow-600":""}
  `,i.textContent=t,n.appendChild(i),setTimeout(()=>{i.parentElement&&i.parentElement.removeChild(i),I&&I.children.length===0&&(document.body.removeChild(I),I=null)},g),i}const J=t=>re(t,"success"),K=t=>re(t,"error"),G=R("BartendersTab"),pe=()=>{const[t,m]=c.useState([]),[g,n]=c.useState(!0),[i,o]=c.useState(null),[h,v]=c.useState(null),[b,_]=c.useState({}),[d,r]=c.useState(""),[s,f]=c.useState(1),[u,p]=c.useState(10),[E,a]=c.useState("created_at"),[N,k]=c.useState("desc"),[C,P]=c.useState("all");c.useEffect(()=>{M()},[E,N,C,s,u]);const M=async()=>{try{n(!0);let l=w.from("bartenders").select(`
          id,
          full_name,
          bar,
          user_id,
          is_admin,
          is_approved,
          is_profile_claimed,
          is_archived,
          created_at,
          updated_at
        `);C==="approved"?l=l.eq("is_approved",!0):C==="unapproved"?l=l.eq("is_approved",!1):C==="archived"?l=l.eq("is_archived",!0):C==="active"&&(l=l.eq("is_archived",!1)),d&&(l=l.ilike("full_name",`%${d}%`)),l=l.order(E,{ascending:N==="asc"});const $=(s-1)*u,q=$+u-1;l=l.range($,q);const{data:F,error:T,count:Pe}=await l;if(T)throw T;m(F||[]);const{count:se}=await w.from("bartenders").select("id",{count:"exact",head:!0});H(Math.ceil(se/u))}catch(l){G.error("Error fetching bartenders:",l),o(l.message)}finally{n(!1)}},[L,H]=c.useState(1),Y=l=>{v(l.id),_({...l})},V=async()=>{try{n(!0);const{error:l}=await w.from("bartenders").update(b).eq("id",h);if(l)throw l;J("Bartender updated successfully"),await M(),v(null),_({})}catch(l){G.error("Error saving bartender:",l),o(l.message),K(`Error: ${l.message}`)}finally{n(!1)}},x=()=>{v(null),_({})},y=(l,$)=>{_(q=>({...q,[l]:$}))},S=async(l,$)=>{try{n(!0);let q={},F="";switch($){case"approve":q={is_approved:!0},F="Bartender approved successfully";break;case"reject":q={is_approved:!1},F="Bartender rejected successfully";break;case"archive":q={is_archived:!0},F="Bartender archived successfully";break;case"unarchive":q={is_archived:!1},F="Bartender restored successfully";break;default:throw new Error("Invalid action")}const{error:T}=await w.from("bartenders").update(q).eq("id",l);if(T)throw T;J(F),await M()}catch(q){G.error(`Error performing ${$} action:`,q),o(q.message),K(`Error: ${q.message}`)}finally{n(!1)}},D=l=>{E===l?k(N==="asc"?"desc":"asc"):(a(l),k("asc"))},A=l=>E!==l?"â†•":N==="asc"?"â†‘":"â†“",j=(l,$,q="text")=>h===l.id?q==="checkbox"?e.createElement("input",{type:"checkbox",checked:b[$]||!1,onChange:T=>y($,T.target.checked),className:"form-checkbox h-5 w-5 text-blue-600"}):e.createElement("input",{type:q,value:b[$]||"",onChange:T=>y($,T.target.value),className:"w-full bg-gray-700 text-white px-2 py-1 rounded"}):q==="checkbox"?e.createElement("span",{className:l[$]?"text-green-400":"text-red-400"},l[$]?"Yes":"No"):l[$]||e.createElement("span",{className:"text-gray-500"},"â€”");return g&&t.length===0?e.createElement("div",{className:"flex justify-center items-center h-64"},e.createElement("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"})):e.createElement("div",null,e.createElement("div",{className:"mb-6 bg-gray-800 p-4 rounded-lg"},e.createElement("div",{className:"flex flex-col md:flex-row gap-4 mb-4"},e.createElement("div",{className:"flex-1"},e.createElement("input",{type:"text",placeholder:"Search by name...",value:d,onChange:l=>r(l.target.value),className:"w-full p-2 bg-gray-700 text-white rounded border border-gray-600"})),e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:()=>{r(""),M()},className:"px-4 py-2 bg-blue-600 text-white rounded"},"Search"),e.createElement("select",{value:C,onChange:l=>P(l.target.value),className:"p-2 bg-gray-700 text-white rounded border border-gray-600"},e.createElement("option",{value:"all"},"All Bartenders"),e.createElement("option",{value:"approved"},"Approved"),e.createElement("option",{value:"unapproved"},"Unapproved"),e.createElement("option",{value:"active"},"Active (Not Archived)"),e.createElement("option",{value:"archived"},"Archived"))))),i&&e.createElement("div",{className:"bg-red-900/50 border border-red-500 text-red-200 p-4 rounded-lg mb-6"},i),e.createElement("div",{className:"bg-gray-800 rounded-lg overflow-hidden"},e.createElement("div",{className:"overflow-x-auto"},e.createElement("table",{className:"min-w-full divide-y divide-gray-700"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{className:"px-4 py-3 text-left"},e.createElement("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("full_name")},"Name ",A("full_name"))),e.createElement("th",{className:"px-4 py-3 text-left"},e.createElement("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("bar")},"Bar ",A("bar"))),e.createElement("th",{className:"px-4 py-3 text-left"},e.createElement("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("is_approved")},"Approved ",A("is_approved"))),e.createElement("th",{className:"px-4 py-3 text-left"},e.createElement("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("is_profile_claimed")},"Claimed ",A("is_profile_claimed"))),e.createElement("th",{className:"px-4 py-3 text-left"},e.createElement("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("is_admin")},"Admin ",A("is_admin"))),e.createElement("th",{className:"px-4 py-3 text-left"},e.createElement("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("is_archived")},"Archived ",A("is_archived"))),e.createElement("th",{className:"px-4 py-3 text-left"},e.createElement("button",{className:"text-xs font-medium text-gray-400 uppercase flex items-center",onClick:()=>D("created_at")},"Created ",A("created_at"))),e.createElement("th",{className:"px-4 py-3"}))),e.createElement("tbody",{className:"divide-y divide-gray-700"},t.map(l=>e.createElement("tr",{key:l.id,className:l.is_archived?"opacity-50":""},e.createElement("td",{className:"px-4 py-3 text-sm text-white"},j(l,"full_name")),e.createElement("td",{className:"px-4 py-3 text-sm text-gray-300"},j(l,"bar")),e.createElement("td",{className:"px-4 py-3 text-sm"},j(l,"is_approved","checkbox")),e.createElement("td",{className:"px-4 py-3 text-sm"},j(l,"is_profile_claimed","checkbox")),e.createElement("td",{className:"px-4 py-3 text-sm"},j(l,"is_admin","checkbox")),e.createElement("td",{className:"px-4 py-3 text-sm"},j(l,"is_archived","checkbox")),e.createElement("td",{className:"px-4 py-3 text-sm text-gray-400"},new Date(l.created_at).toLocaleDateString()),e.createElement("td",{className:"px-4 py-3 text-sm whitespace-nowrap"},e.createElement("div",{className:"flex gap-2"},e.createElement(ue,{id:l.id,isEditing:h===l.id,onEdit:()=>Y(l),onSave:V,onCancel:x,disabled:g}),h!==l.id&&e.createElement("div",{className:"flex gap-2 ml-2"},!l.is_approved&&e.createElement("button",{onClick:()=>S(l.id,"approve"),className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white transition-colors",title:"Approve"},"âœ“"),l.is_approved&&e.createElement("button",{onClick:()=>S(l.id,"reject"),className:"bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white transition-colors",title:"Reject"},"âœ•"),l.is_archived?e.createElement("button",{onClick:()=>S(l.id,"unarchive"),className:"bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-white transition-colors",title:"Restore"},"ðŸ”„"):e.createElement("button",{onClick:()=>S(l.id,"archive"),className:"bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded text-white transition-colors",title:"Archive"},"ðŸ“¦")))))))))),e.createElement("div",{className:"mt-4 flex justify-between items-center"},e.createElement("div",null,e.createElement("select",{value:u,onChange:l=>{p(Number(l.target.value)),f(1)},className:"bg-gray-700 text-white rounded p-2 border border-gray-600"},e.createElement("option",{value:10},"10 per page"),e.createElement("option",{value:25},"25 per page"),e.createElement("option",{value:50},"50 per page"),e.createElement("option",{value:100},"100 per page"))),e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:()=>f(l=>Math.max(l-1,1)),disabled:s===1,className:"px-3 py-1 bg-gray-700 text-white rounded disabled:opacity-50"},"Previous"),e.createElement("span",{className:"px-3 py-1 bg-gray-700 text-white rounded"},"Page ",s," of ",L),e.createElement("button",{onClick:()=>f(l=>Math.min(l+1,L)),disabled:s===L,className:"px-3 py-1 bg-gray-700 text-white rounded disabled:opacity-50"},"Next"))))},fe=({competition:t,onSave:m,onCancel:g})=>{const[n,i]=c.useState({name:t.name||"",date:t.date||"",venue:t.venue||"",country:t.country||""}),[o,h]=c.useState(!1),[v,b]=c.useState(!1),[_,d]=c.useState(null);c.useEffect(()=>{i({name:t.name||"",date:t.date||"",venue:t.venue||"",country:t.country||""}),h(!1),d(null)},[t]);const r=(u,p)=>{i(E=>({...E,[u]:p})),h(!0),d(null)},s=()=>{var p,E;if(!((p=n.name)!=null&&p.trim()))throw new Error("Competition name is required");if(!n.date)throw new Error("Competition date is required");if(!((E=n.venue)!=null&&E.trim()))throw new Error("Venue is required");const u=new Date(n.date);if(isNaN(u.getTime()))throw new Error("Invalid date format")},f=async()=>{if(!o){g();return}b(!0),d(null);try{s(),await m({...n,name:n.name.trim(),venue:n.venue.trim(),country:n.country||null,date:new Date(n.date).toISOString().split("T")[0]})}catch(u){d(u.message),b(!1);return}b(!1)};return e.createElement("div",{className:"bg-gray-700 rounded p-6"},_&&e.createElement("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500 text-red-200 rounded"},_),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},e.createElement("div",null,e.createElement("label",{className:"block text-white mb-2"},"Competition Name ",e.createElement("span",{className:"text-red-400"},"*")),e.createElement("input",{type:"text",value:n.name,onChange:u=>r("name",u.target.value),className:"w-full p-2 bg-gray-600 text-white rounded border border-gray-500 focus:border-blue-500 focus:outline-none",placeholder:"Enter competition name",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-white mb-2"},"Date ",e.createElement("span",{className:"text-red-400"},"*")),e.createElement("input",{type:"date",value:n.date,onChange:u=>r("date",u.target.value),className:"w-full p-2 bg-gray-600 text-white rounded border border-gray-500 focus:border-blue-500 focus:outline-none",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-white mb-2"},"Venue ",e.createElement("span",{className:"text-red-400"},"*")),e.createElement("input",{type:"text",value:n.venue,onChange:u=>r("venue",u.target.value),className:"w-full p-2 bg-gray-600 text-white rounded border border-gray-500 focus:border-blue-500 focus:outline-none",placeholder:"Enter venue name",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-white mb-2"},"Country"),e.createElement("select",{value:n.country||"",onChange:u=>r("country",u.target.value),className:"w-full p-2 bg-gray-600 text-white rounded border border-gray-500 focus:border-blue-500 focus:outline-none"},e.createElement("option",{value:""},"Select a country"),ce.map(u=>e.createElement("option",{key:u,value:u},u))))),e.createElement("div",{className:"flex justify-end gap-2"},e.createElement("button",{onClick:g,disabled:v,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed"},"Cancel"),e.createElement("button",{onClick:f,disabled:v||!o&&!_,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},v?"Saving...":"Save Changes")))},Q=R("ResultsTable"),be=t=>{if(!t)return"";t=t.replace(/^(https?:\/\/)/,""),t.startsWith("www.")&&(t=t.substring(4));const m=t.split("/").filter(Boolean),g=m[0],n=m[m.length-1]||"";return`${g}/../${n}`},he=({results:t=[],competitionStatus:m,onResultStatusChange:g})=>{Q.debug("Rendering results table",{resultCount:t==null?void 0:t.length,competitionStatus:m});const n=m==="approved";if(Q.debug("ResultsTable actions visibility",{competitionStatus:m,showActions:n}),!(t!=null&&t.length))return e.createElement("div",{className:"bg-gray-700 p-4 rounded text-gray-400 text-center"},"No results available");const i=[...t].sort((o,h)=>o.placement-h.placement);return e.createElement("div",{className:"bg-gray-700 rounded overflow-hidden"},e.createElement("table",{className:"w-full text-left"},e.createElement("thead",{className:"bg-gray-600"},e.createElement("tr",null,e.createElement("th",{className:"p-3 text-white"},"Position"),e.createElement("th",{className:"p-3 text-white"},"Bartender"),e.createElement("th",{className:"p-3 text-white"},"Source"),e.createElement("th",{className:"p-3 text-white"},"Status"),n&&e.createElement("th",{className:"p-3 text-white"},"Actions"))),e.createElement("tbody",null,i.map(o=>{var h;return e.createElement("tr",{key:o.id,className:"border-t border-gray-600"},e.createElement("td",{className:"p-3 text-white"},o.placement),e.createElement("td",{className:"p-3 text-white"},((h=o.bartenders)==null?void 0:h.full_name)||"Unknown Bartender"),e.createElement("td",{className:"p-3 text-white"},o.result_source?e.createElement("a",{href:o.result_source,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300"},be(o.result_source)):"No source"),e.createElement("td",{className:`p-3 ${o.status==="pending"?"text-yellow-400":o.status==="approved"?"text-green-400":o.status==="rejected"?"text-red-400":o.status==="deprecated"?"text-gray-400":"text-white"}`},o.status||"pending"),n&&e.createElement("td",{className:"p-3"},o.status==="pending"&&e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:()=>g==null?void 0:g(o.id,"approved"),className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white"},"Approve"),e.createElement("button",{onClick:()=>g==null?void 0:g(o.id,"rejected"),className:"bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white"},"Reject"))))}))))},Ee=({sourceCompetition:t,targetCompetitions:m,onClose:g,onMerge:n})=>{var r;const[i,o]=c.useState(null),[h,v]=c.useState({name:!1,date:!1,venue:!1,country:!1,organizer:!1,results:!0}),[b,_]=c.useState("");c.useEffect(()=>{o(null),v({name:!1,date:!1,venue:!1,country:!1,organizer:!1,results:!0}),_("")},[t==null?void 0:t.id]);const d=async()=>{if(!i)return;const s=m.find(f=>f.id===i);await n({sourceId:t.id,targetId:i,fields:h,notes:b,sourceCompetition:t,targetCompetition:s}),g()};return e.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},e.createElement("div",{className:"bg-gray-800 rounded-lg p-6 max-w-4xl w-full m-4 max-h-[90vh] overflow-y-auto"},e.createElement("div",{className:"flex justify-between items-center mb-6"},e.createElement("h2",{className:"text-xl font-bold text-white"},"Select Competition to Merge Into"),e.createElement("button",{onClick:g,className:"text-gray-400 hover:text-white"},"Ã—")),e.createElement("div",{className:"mb-6"},e.createElement("h3",{className:"text-lg text-white mb-2"},"Source Competition"),e.createElement("div",{className:"bg-gray-700 p-4 rounded"},e.createElement("div",{className:"text-white"},t.name),e.createElement("div",{className:"text-gray-400"},new Date(t.date).toLocaleDateString()," at ",t.venue),((r=t.legacy_results)==null?void 0:r.length)>0&&e.createElement("div",{className:"mt-2 text-gray-400"},"Results: ",t.legacy_results.length," competitor(s)"))),e.createElement("div",{className:"mb-6"},e.createElement("h3",{className:"text-lg text-white mb-2"},"Similar Competitions"),e.createElement("div",{className:"space-y-2"},m==null?void 0:m.map(s=>e.createElement("div",{key:s.id,onClick:()=>o(s.id),className:`p-4 rounded cursor-pointer transition-colors ${i===s.id?"bg-blue-600":"bg-gray-700 hover:bg-gray-600"}`},e.createElement("div",{className:"text-white"},s.name),e.createElement("div",{className:"text-gray-400"},new Date(s.date).toLocaleDateString()," at ",s.venue))))),i&&e.createElement("div",{className:"mb-6"},e.createElement("h3",{className:"text-lg text-white mb-4"},"Fields to Merge"),e.createElement("div",{className:"space-y-4"},Object.entries({name:"Competition Name",date:"Date",venue:"Venue",country:"Country",organizer:"Organizer",results:"Results"}).map(([s,f])=>{var u;return e.createElement("div",{key:s,className:"flex justify-between items-center bg-gray-700 p-4 rounded"},e.createElement("div",null,e.createElement("div",{className:"text-white font-medium mb-1"},f),s!=="results"&&e.createElement("div",{className:"grid grid-cols-2 gap-4"},e.createElement("div",{className:"text-gray-400"},"Source: ",t[s]||"Not set"),e.createElement("div",{className:"text-gray-400"},"Target: ",((u=m.find(p=>p.id===i))==null?void 0:u[s])||"Not set"))),e.createElement("label",{className:"flex items-center"},e.createElement("input",{type:"checkbox",checked:h[s],onChange:p=>v(E=>({...E,[s]:p.target.checked})),className:"mr-2",disabled:s==="results"}),e.createElement("span",{className:"text-white"},"Use source value")))}))),e.createElement("div",{className:"mb-6"},e.createElement("label",{className:"block text-white mb-2"},"Merge Notes"),e.createElement("textarea",{value:b,onChange:s=>_(s.target.value),className:"w-full p-2 bg-gray-700 text-white rounded border border-gray-600",rows:3,placeholder:"Add notes about why these competitions are being merged..."})),e.createElement("div",{className:"flex justify-end gap-4"},e.createElement("button",{onClick:g,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"},"Cancel"),e.createElement("button",{onClick:d,disabled:!i,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"},"Merge Competitions"))))},X=R("ResultsConflictResolution"),xe=({competitionId:t,results:m=[],onResolve:g})=>{const[n,i]=c.useState([]),[o,h]=c.useState(!1),[v,b]=c.useState(null);c.useEffect(()=>{t&&_()},[t]);const _=async()=>{try{const{data:r,error:s}=await w.from("legacy_results").select(`
          id,
          bartender_id,
          placement,
          points,
          status,
          pre_competition_rating,
          post_competition_rating,
          bartenders (
            id,
            full_name,
            rating
          )
        `).eq("legacy_competition_id",t).eq("status","pending_review");if(s)throw s;if(!(r!=null&&r.length)){i([]);return}const f=r.map(a=>a.bartender_id),{data:u,error:p}=await w.from("legacy_results").select(`
          id,
          bartender_id,
          placement,
          points,
          status,
          legacy_competition_id,
          legacy_competitions (
            id,
            name,
            date
          ),
          bartenders (
            id,
            full_name
          )
        `).in("bartender_id",f).neq("legacy_competition_id",t).eq("status","approved");if(p)throw p;const E=r.map(a=>({...a,otherResults:(u==null?void 0:u.filter(N=>N.bartender_id===a.bartender_id))||[]}));i(E)}catch(r){X.error("Error fetching conflicts:",r),b(r.message)}},d=async(r,s)=>{h(!0);try{const f=n.find(p=>p.id===r);if(!f)return;const{error:u}=await w.from("legacy_results").update({status:s==="approve"?"approved":"rejected",updated_at:new Date().toISOString()}).eq("id",r);if(u)throw u;if(s==="approve"){const p=f.otherResults.map(E=>w.from("legacy_results").update({status:"deprecated",updated_at:new Date().toISOString()}).eq("id",E.id));await Promise.all(p)}await _(),g==null||g()}catch(f){X.error("Error resolving conflict:",f),b(f.message)}finally{h(!1)}};return n.length?e.createElement("div",{className:"mt-8 bg-gray-800 p-6 rounded-lg"},e.createElement("h3",{className:"text-xl text-white mb-4"},"Resolve Results"),v&&e.createElement("div",{className:"bg-red-500/20 border border-red-500 text-red-200 p-4 rounded mb-4"},v),e.createElement("div",{className:"space-y-4"},n.map(r=>{var s;return e.createElement("div",{key:r.id,className:"bg-gray-700 p-4 rounded"},e.createElement("div",{className:"flex justify-between items-start"},e.createElement("div",null,e.createElement("h4",{className:"text-white font-medium"},((s=r.bartenders)==null?void 0:s.full_name)||"Unknown Bartender"),e.createElement("div",{className:"mt-2 text-gray-400"},e.createElement("div",null,"Placement: ",r.placement),e.createElement("div",null,"Points: ",r.points),r.otherResults.length>0&&e.createElement("div",{className:"mt-2"},e.createElement("div",{className:"text-yellow-400"},"Existing Results:"),r.otherResults.map(f=>{var u,p;return e.createElement("div",{key:f.id,className:"ml-4 mt-1"},e.createElement("div",null,(u=f.legacy_competitions)==null?void 0:u.name),e.createElement("div",null,"Date: ",new Date((p=f.legacy_competitions)==null?void 0:p.date).toLocaleDateString()),e.createElement("div",null,"Placement: ",f.placement),e.createElement("div",null,"Points: ",f.points))})))),e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:()=>d(r.id,"approve"),disabled:o,className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"},"Approve"),e.createElement("button",{onClick:()=>d(r.id,"reject"),disabled:o,className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50"},"Reject"))))}))):null},O=R("useCompetitionMerge"),ye=(t,m)=>{const[g,n]=c.useState(null),[i,o]=c.useState([]),[h,v]=c.useState({isOpen:!1,sourceCompetition:null,targetCompetition:null});return{selectedId:g,setSelectedId:n,similarCompetitions:i,mergeModalState:h,setMergeModalState:v,handleMergeClick:async(d,r=null)=>{var s;O.debug("Handling merge click",{sourceId:d,targetId:r});try{const{data:f,error:u}=await w.from("legacy_competitions").select(`
          *,
          legacy_results (
            id,
            bartender_id,
            placement,
            points,
            status,
            bartenders (
              id,
              full_name
            )
          )
        `).eq("id",d).single();if(u)throw u;O.debug("Fetched source competition",{id:f.id,resultsCount:(s=f.legacy_results)==null?void 0:s.length});const{data:p,error:E}=await w.from("legacy_competitions").select(`
          *,
          legacy_results (
            id,
            bartender_id,
            placement,
            points,
            status,
            bartenders (
              id,
              full_name
            )
          )
        `).neq("id",d).not("status","in",'("merged")').ilike("name",`%${f.name.split(" ").join("%")}%`);if(E)throw E;if(o(p||[]),r){const a=p==null?void 0:p.find(N=>N.id===r);a&&v({isOpen:!0,sourceCompetition:f,targetCompetition:a})}else(p==null?void 0:p.length)>0&&v({isOpen:!0,sourceCompetition:f,targetCompetition:null})}catch(f){throw O.error("Error preparing merge:",f),f}},handleMergeComplete:async d=>{O.debug("Starting merge with details:",{sourceId:d.sourceId,targetId:d.targetId});try{const{data:{user:r}}=await w.auth.getUser();if(!r)throw new Error("Authentication required");const{error:s}=await w.from("legacy_competitions").update({status:"merged",merged_into_id:d.targetId,merge_notes:d.notes,updated_by:r.id,updated_at:new Date().toISOString()}).eq("id",d.sourceId);if(s)throw s;O.info("Merge completed successfully"),await m(),n(null),v({isOpen:!1,sourceCompetition:null,targetCompetition:null})}catch(r){throw O.error("Error completing merge:",r),r}}}},z=R("Competition"),ve=({competition:t,onUpdate:m,onResultStatusChange:g})=>{const[n,i]=c.useState(!1),[o,h]=c.useState(!1),[v,b]=c.useState(null),[_,d]=c.useState(!1),[r,s]=c.useState([]);z.debug("Competition component rendering",{competitionId:t.id,competitionStatus:t.status,competitionName:t.name}),ye(t,m);const f=async()=>{h(!0),b(null);try{z.debug("Checking similar competitions",{competitionId:t.id});const{data:E,error:a}=await w.from("legacy_competitions").select(`
          id, 
          name,
          date,
          venue,
          country,
          status,
          category,
          legacy_results (
            id,
            bartender_id,
            placement,
            points,
            status,
            result_source,
            competition_category
          )
        `).neq("id",t.id).not("status","in",'("merged")').ilike("name",`%${t.name.split(" ").join("%")}%`);if(a)throw a;s(E||[]),d(!0)}catch(E){z.error("Error finding similar competitions:",E),b(E.message)}finally{h(!1)}},u=async()=>{h(!0);try{const{error:E}=await w.from("legacy_competitions").update({status:"approved",updated_at:new Date().toISOString()}).eq("id",t.id);if(E)throw E;const{error:a}=await w.from("legacy_results").update({status:"pending",updated_at:new Date().toISOString()}).eq("legacy_competition_id",t.id);if(a)throw a;const{error:N}=await w.from("recalculation_queue").insert([{competition_id:t.id,queued_at:new Date().toISOString()}]).single();if(N&&!N.message.includes("duplicate"))throw N;await m()}catch(E){z.error("Error approving competition:",E),b(E.message)}finally{h(!1)}},p=async E=>{try{if(Object.values(E.fields).some(Boolean)){const N={};Object.entries(E.fields).forEach(([C,P])=>{P&&C!=="results"&&(N[C]=t[C])});const{error:k}=await w.from("legacy_competitions").update(N).eq("id",E.targetId);if(k)throw k}const{error:a}=await w.from("legacy_competitions").update({status:"merged",merged_into_id:E.targetId,merge_notes:E.notes,updated_at:new Date().toISOString()}).eq("id",t.id);if(a)throw a;d(!1),s([]),m()}catch(a){z.error("Error merging competitions:",a),b(a.message)}};return e.createElement("div",{className:"bg-gray-800 rounded-lg p-6 mb-6"},v&&e.createElement("div",{className:"bg-red-500/20 border border-red-500 text-red-200 p-4 rounded mb-4"},v),e.createElement("div",{className:"flex justify-between items-start mb-4"},e.createElement("div",null,e.createElement("h3",{className:"text-xl text-white font-medium"},t.name,t.status==="pending"&&e.createElement("span",{className:"ml-2 text-yellow-400 text-sm"},"(Pending Approval)")),e.createElement("p",{className:"text-gray-400"},t.date&&new Date(t.date).toLocaleDateString("en-GB")," at ",t.venue),t.country&&e.createElement("p",{className:"text-gray-400"},"Country: ",t.country),e.createElement("p",{className:"text-gray-400 mt-1"},"Category: ",t.category?e.createElement("span",{className:"capitalize"},t.category):"Legacyzz")),e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",disabled:o},"Edit Details"),t.status==="pending"&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:u,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",disabled:o},o?"Processing...":"Approve Competition"),e.createElement("button",{onClick:f,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50",disabled:o},"Check Similar")))),n&&e.createElement(fe,{competition:t,onSave:async E=>{try{const{error:a}=await w.from("legacy_competitions").update(E).eq("id",t.id);if(a)throw a;i(!1),m()}catch(a){b(a.message)}},onCancel:()=>i(!1)}),_&&(r==null?void 0:r.length)>0&&e.createElement(Ee,{sourceCompetition:t,targetCompetitions:r,onClose:()=>{d(!1),s([])},onMerge:p}),e.createElement("div",{className:"mt-6"},e.createElement("h4",{className:"text-lg text-white mb-4"},"Competition Results"),e.createElement(he,{results:t.legacy_results,competitionStatus:t.status,onResultStatusChange:g})),t.status==="approved"&&e.createElement(xe,{competitionId:t.id,results:t.legacy_results,onResolve:m}))},we=R("CompetitionFilter"),Ne=({onFilter:t})=>{const[m,g]=c.useState({name:"",date:"",organizer:null}),[n,i]=c.useState(!1),o=(b,_)=>{g(d=>({...d,[b]:_}))},h=()=>{we.debug("Applying filters:",m),i(!0),t==null||t(m)},v=()=>{const b={name:"",date:"",organizer:null};g(b),i(!1),t==null||t(b)};return e.createElement("div",{className:"bg-gray-800 p-4 rounded-lg mb-6"},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},e.createElement("div",null,e.createElement("label",{className:"block text-white mb-2"},"Competition Name"),e.createElement("input",{type:"text",value:m.name,onChange:b=>o("name",b.target.value),placeholder:"Search by name...",className:"w-full p-2 bg-gray-700 text-white rounded border border-gray-600"})),e.createElement("div",null,e.createElement("label",{className:"block text-white mb-2"},"Date"),e.createElement("input",{type:"date",value:m.date,onChange:b=>o("date",b.target.value),className:"w-full p-2 bg-gray-700 text-white rounded border border-gray-600"})),e.createElement("div",null,e.createElement("label",{className:"block text-white mb-2"},"Organizer"),e.createElement(ie,{onSelect:b=>o("organizer",b),placeholder:"Select organizer..."}))),e.createElement("div",{className:"flex justify-end gap-2"},n&&e.createElement("button",{onClick:v,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded"},"Clear Filters"),e.createElement("button",{onClick:h,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded"},"Search")))},_e=R("RatingHistoryViewer"),Ce=({bartenderId:t,category:m="legacy",showDetails:g=!1})=>{const[n,i]=c.useState([]),[o,h]=c.useState(!0),[v,b]=c.useState(null);if(c.useEffect(()=>{t&&(async()=>{try{let{data:r,error:s}=await w.from("rating_calculations_history").select(`
              id,
              competition_id,
              calculation_time,
              effective_date,
              old_rating,
              new_rating,
              old_rd,
              new_rd,
              old_volatility,
              new_volatility,
              category
            `).eq("bartender_id",t).eq("category",m).order("effective_date",{ascending:!0});if(s)throw s;const f=r.filter(u=>u.competition_id).map(u=>u.competition_id);if(f.length>0){const{data:u,error:p}=await w.from("legacy_competitions").select("id, name, date").in("id",f);if(p)throw p;r=r.map(E=>({...E,competition:u.find(a=>a.id===E.competition_id)}))}i(r||[])}catch(r){_e.error("Error fetching history:",r),b(r.message)}finally{h(!1)}})()},[t,m]),o)return e.createElement("div",{className:"flex justify-center p-4"},e.createElement("div",{className:"w-6 h-6 border-2 border-blue-600 rounded-full animate-spin"}));if(v)return e.createElement("div",{className:"text-red-500 p-4"},v);if(!n.length)return e.createElement("div",{className:"text-gray-400 p-4"},"No rating history available");const _=new Date;return _.setFullYear(_.getFullYear()-1),e.createElement("div",{className:"overflow-hidden rounded-lg"},e.createElement("div",{className:"overflow-x-auto"},e.createElement("table",{className:"min-w-full divide-y divide-gray-700"},e.createElement("thead",{className:"bg-gray-800"},e.createElement("tr",null,e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"Date"),e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"Competition"),e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"Rating Change"),g&&e.createElement(e.Fragment,null,e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"RD"),e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"Volatility")))),e.createElement("tbody",{className:"divide-y divide-gray-700"},n.map(d=>{var p;const r=new Date(d.effective_date)<_,s=d.new_rating-d.old_rating,f=d.new_rd-d.old_rd,u=d.new_volatility-d.old_volatility;return e.createElement("tr",{key:d.id,className:`${r?"opacity-50":""}`},e.createElement("td",{className:"px-4 py-3 whitespace-nowrap"},e.createElement("div",{className:"text-sm text-white"},d.effective_date?new Date(d.effective_date).toLocaleDateString():"N/A"),g&&e.createElement("div",{className:"text-xs text-gray-400"},"Calculated: ",new Date(d.calculation_time).toLocaleString())),e.createElement("td",{className:"px-4 py-3"},e.createElement("div",{className:"text-sm text-white"},((p=d.competition)==null?void 0:p.name)||"System Update")),e.createElement("td",{className:"px-4 py-3"},e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:`text-sm ${s>0?"text-green-400":s<0?"text-red-400":"text-gray-400"}`},s>0?"+":"",Math.round(s)),e.createElement("span",{className:"text-gray-400 mx-2"},"â†’"),e.createElement("span",{className:"text-white"},Math.round(d.new_rating)))),g&&e.createElement(e.Fragment,null,e.createElement("td",{className:"px-4 py-3 text-sm"},e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:`text-sm ${f<0?"text-green-400":f>0?"text-red-400":"text-gray-400"}`},f<0?"":"+",f.toFixed(1)),e.createElement("span",{className:"text-gray-400 mx-2"},"â†’"),e.createElement("span",{className:"text-white"},d.new_rd.toFixed(1)))),e.createElement("td",{className:"px-4 py-3 text-sm"},e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:`text-sm ${u<0?"text-green-400":u>0?"text-red-400":"text-gray-400"}`},u<0?"":"+",u.toFixed(3)),e.createElement("span",{className:"text-gray-400 mx-2"},"â†’"),e.createElement("span",{className:"text-white"},d.new_volatility.toFixed(3))))))})))))},Z=R("ResultsManagementTab"),ee=()=>{const[t,m]=c.useState([]),[g,n]=c.useState(!0),[i,o]=c.useState(null),[h,v]=c.useState({});c.useState(null);const b=async()=>{var d;try{n(!0),o(null);let r=w.from("legacy_competitions").select(`
          id,
          name,
          date,
          venue,
          country,
          status,
          category,
          created_at,
          updated_at,
          created_by,
          updated_by,
          organizer,
          legacy_results (
            id,
            bartender_id,
            placement,
            points,
            status,
            result_source,
            pre_competition_rating,
            post_competition_rating,
            competition_category,
            pre_competition_rd,
            post_competition_rd,
            pre_competition_volatility,
            post_competition_volatility,
            bartenders (
              id,
              full_name
            )
          )
        `).not("status","eq","merged").order("date",{ascending:!1});if(h.name&&(r=r.ilike("name",`%${h.name}%`)),h.date){const p=new Date(h.date).toISOString().split("T")[0];r=r.eq("date",p)}(d=h.organizer)!=null&&d.id&&(r=r.eq("organizer",h.organizer.id));const{data:s,error:f}=await r;if(f)throw f;const u=await Promise.all(s.map(async p=>{if(!p.legacy_results)return p;const E=await Promise.all(p.legacy_results.map(async a=>{const{data:N}=await w.from("rating_calculations_history").select("*").eq("competition_id",p.id).eq("bartender_id",a.bartender_id).eq("category",a.competition_category||"legacy").single();return{...a,rating_history:N}}));return{...p,legacy_results:E}}));m(u)}catch(r){Z.error("Error fetching competitions:",r),o(r.message)}finally{n(!1)}};c.useEffect(()=>{b()},[h]);const _=async(d,r)=>{try{const{error:s}=await w.from("legacy_results").update({status:r,updated_at:new Date().toISOString()}).eq("id",d);if(s)throw s;await b()}catch(s){Z.error("Error updating result status:",s),o(s.message)}};return g?e.createElement("div",{className:"flex justify-center items-center h-64"},e.createElement("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"})):e.createElement("div",null,e.createElement("h2",{className:"text-2xl font-bold text-white mb-6"},"Competition Results Management"),e.createElement(Ne,{onFilter:v}),i&&e.createElement("div",{className:"bg-red-500/20 border border-red-500 text-red-200 p-4 rounded mb-6"},i),e.createElement("div",{className:"space-y-6"},t.map(d=>e.createElement(ve,{key:d.id,competition:d,onUpdate:b,onResultStatusChange:_})),t.length===0&&e.createElement("div",{className:"text-center text-gray-400 py-8"},"No competitions found")))},W=R("AdminTable"),te=({sources:t})=>t!=null&&t.length?e.createElement("div",{className:"space-y-1"},t.map((m,g)=>e.createElement("a",{key:g,href:m.url,target:"_blank",rel:"noopener noreferrer",className:"block text-blue-400 hover:text-blue-300 truncate"},m.url))):e.createElement("span",{className:"text-gray-400"},"No sources"),Se=({tableName:t,showApproveButtons:m=!1,defaultFilters:g={}})=>{const[n,i]=c.useState([]),[o,h]=c.useState(!0),[v,b]=c.useState(null),[_,d]=c.useState(null),[r,s]=c.useState({}),[f,u]=c.useState(g),[p,E]=c.useState({key:"created_at",direction:"desc"}),[a,N]=c.useState({});c.useEffect(()=>{k();const x=C();return()=>x==null?void 0:x.unsubscribe()},[t]);const k=async()=>{try{h(!0);let x=w.from(t).select("*");t==="legacy_competitions"?x=w.from(t).select(`
          *,
          sources (
            id,
            url,
            created_at
          )
        `):t==="legacy_results"&&(x=w.from(t).select(`
          *,
          legacy_competition:legacy_competition_id (
            id,
            name,
            sources (
              id,
              url,
              created_at
            )
          )
        `));const{data:y,error:S}=await x;if(S)throw S;const D={};y&&y.forEach(A=>{var j;A.sources?D[A.id]=A.sources:(j=A.legacy_competition)!=null&&j.sources&&(D[A.id]=A.legacy_competition.sources)}),N(D),i(y||[]),b(null)}catch(x){W.error("Error loading data",x),b(x.message),i([])}finally{h(!1)}},C=()=>w.channel(`${t}_changes`).on("postgres_changes",{event:"*",schema:"public",table:t},()=>k()).subscribe(),P=async x=>{try{const y={...r};delete y.id,delete y.created_at,delete y.updated_at,delete y.sources;const{error:S}=await w.from(t).update(y).eq("id",x);if(S)throw S;await k(),d(null),s({})}catch(y){W.error("Error saving row",y),b(y.message)}},M=async(x,y)=>{try{const{error:S}=await w.from(t).update({status:y}).eq("id",x);if(S)throw S;await k()}catch(S){W.error("Error updating status",S),b(S.message)}},L=c.useMemo(()=>n!=null&&n.length?n.filter(x=>Object.keys(f).every(y=>{if(!f[y])return!0;const S=x[y];return S==null?!1:String(S).toLowerCase().includes(String(f[y]).toLowerCase())})).sort((x,y)=>{if(!p.key)return 0;const S=x[p.key],D=y[p.key];return S===null?1:D===null?-1:p.direction==="asc"?S>D?1:-1:S<D?1:-1}):[],[n,f,p]),H=x=>new Date(x).toLocaleString(),Y=(x,y)=>_===x.id?y==="sources"?e.createElement(te,{sources:a[x.id]}):y==="created_at"||y==="updated_at"?H(x[y]):e.createElement("input",{type:"text",value:r[y]||"",onChange:S=>s(D=>({...D,[y]:S.target.value})),className:"w-full bg-gray-700 text-white px-2 py-1 rounded"}):y==="sources"?e.createElement(te,{sources:a[x.id]}):y==="created_at"||y==="updated_at"?H(x[y]):e.isValidElement(x[y])?x[y]:String(x[y]||"");if(o)return e.createElement("div",{className:"flex justify-center items-center h-64"},e.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"}));if(!n.length)return e.createElement("div",{className:"text-center p-8 text-gray-400"},"No data available");const V=[...Object.keys(n[0]),"sources"];return e.createElement("div",null,v&&e.createElement("div",{className:"bg-red-900/50 border border-red-500 text-white p-4 rounded-lg mb-6"},v),e.createElement("div",{className:"bg-gray-800 rounded-lg shadow-xl"},e.createElement("div",{className:"overflow-x-auto"},e.createElement("table",{className:"w-full"},e.createElement("thead",null,e.createElement("tr",null,V.map(x=>e.createElement("th",{key:x,className:"p-4 text-left"},e.createElement("button",{onClick:()=>E({key:x,direction:p.key===x&&p.direction==="asc"?"desc":"asc"}),className:"flex items-center gap-2 hover:text-blue-400 transition-colors"},e.createElement("span",{className:"capitalize"},x.replace(/_/g," ")),e.createElement("span",{className:"text-sm opacity-50"},p.key===x?p.direction==="asc"?"â†‘":"â†“":"â†•")),e.createElement("input",{type:"text",placeholder:`Filter ${x}...`,value:f[x]||"",onChange:y=>u(S=>({...S,[x]:y.target.value})),className:"w-full bg-gray-700 text-white px-2 py-1.5 rounded text-sm border border-gray-600 mt-2"}))),e.createElement("th",{className:"p-4 text-left"},"Actions"))),e.createElement("tbody",null,L.map(x=>e.createElement("tr",{key:x.id,className:"border-t border-gray-700"},V.map(y=>e.createElement("td",{key:y,className:"p-4"},Y(x,y))),e.createElement("td",{className:"p-4"},e.createElement("div",{className:"flex gap-2"},_===x.id?e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>P(x.id),className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white"},"Save"),e.createElement("button",{onClick:()=>{d(null),s({})},className:"bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded text-white"},"Cancel")):e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>{d(x.id),s(x)},className:"bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-white"},"Edit"),m&&x.status==="pending"&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>M(x.id,"approved"),className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-white"},"Approve"),e.createElement("button",{onClick:()=>M(x.id,"denied"),className:"bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white"},"Deny"))))))))))))},ke=R("OrganisersTab"),De=()=>{const t=async()=>{try{const{data:m,error:g}=await w.from("organisers").select("*").order("created_at",{ascending:!1});if(g)throw g;return m}catch(m){throw ke.error("Error fetching organisers",m),m}};return e.createElement(Se,{fetchData:t,tableName:"organisers"})},U=R("ProfileClaimsTab"),ae=({value:t,onChange:m,disabled:g=!1})=>e.createElement("input",{type:"text",value:t||"",onChange:n=>m(n.target.value),disabled:g,className:"w-full bg-gray-700 text-white focus:outline-none focus:ring-1 focus:ring-blue-500 p-2 rounded disabled:opacity-50"}),qe=()=>{const[t,m]=c.useState([]),[g,n]=c.useState(!0),[i,o]=c.useState(null),[h,v]=c.useState(null),[b,_]=c.useState({}),[d,r]=c.useState({});c.useEffect(()=>{s()},[]);const s=async()=>{try{n(!0);const{data:a,error:N}=await w.from("bartenders").select("*").not("users_attempting_to_claim","eq","{}").not("users_attempting_to_claim","is",null);if(N)throw N;const k=[];for(const C of a||[])if(Array.isArray(C.users_attempting_to_claim)&&C.users_attempting_to_claim.length>0){for(const P of C.users_attempting_to_claim)if(P)try{const{data:M}=await w.from("bartenders").select("*").eq("user_id",P).maybeSingle();M&&k.push({targetProfile:C,claimantProfile:M,submission:{id:`${C.id}-${P}`,user_id:P}})}catch(M){U.error(`Error processing claim for user ${P}:`,M)}}m(k),o(null)}catch(a){U.error("Error fetching claims:",a),o(a.message)}finally{n(!1)}},f=async()=>{try{const a=b,N=d,{error:k}=await w.from("bartenders").update({user_id:a.user_id,is_profile_claimed:!0,is_approved:!0,users_attempting_to_claim:[],updated_at:new Date().toISOString()}).eq("id",N.id);if(k)throw k;const{error:C}=await w.from("bartenders").update({is_archived:!0,user_id:null,users_attempting_to_claim:[],updated_at:new Date().toISOString()}).eq("id",a.id);if(C)throw C;await s(),v(null),_({}),r({})}catch(a){U.error("Error accepting claim:",a),o(a.message)}},u=async()=>{try{const a=d,N=b.user_id;if(!a.users_attempting_to_claim)throw new Error("Invalid claim data");const k=a.users_attempting_to_claim.filter(P=>P!==N),{error:C}=await w.from("bartenders").update({users_attempting_to_claim:k,updated_at:new Date().toISOString()}).eq("id",a.id);if(C)throw C;await s(),v(null),_({}),r({})}catch(a){U.error("Error denying claim:",a),o(a.message)}},p=a=>{r(N=>({...N,[a]:b[a]}))},E=(a,N)=>h?e.createElement("div",{className:"flex gap-4 mb-4 items-center"},e.createElement("div",{className:"flex-1 bg-gray-800 p-2 rounded"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement(ae,{value:b[a],onChange:k=>_(C=>({...C,[a]:k}))}),e.createElement("button",{onClick:()=>p(a),className:"text-blue-400 hover:text-blue-300 ml-2 px-2",title:"Copy to right"},"â†’"))),e.createElement("div",{className:"text-gray-400 w-24 text-center text-sm"},N),e.createElement("div",{className:"flex-1 bg-gray-800 p-2 rounded"},e.createElement(ae,{value:d[a],onChange:k=>r(C=>({...C,[a]:k}))}))):null;return g?e.createElement("div",{className:"flex justify-center items-center h-64"},e.createElement("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"})):i?e.createElement("div",{className:"p-4 bg-red-900/50 border border-red-500 text-red-200 rounded"},i):e.createElement("div",{className:"p-4"},e.createElement("h2",{className:"text-2xl mb-6"},"Profile Claims"),h?e.createElement("div",null,e.createElement("button",{onClick:()=>{v(null),_({}),r({})},className:"mb-4 text-gray-400 hover:text-gray-300 flex items-center gap-2"},e.createElement("span",null,"â†")," Back to claims"),e.createElement("div",{className:"mb-6"},e.createElement("h3",{className:"text-xl mb-4"},"Compare Profiles"),E("full_name","Name"),E("bar","Bar"),e.createElement("div",{className:"flex gap-4 mt-8"},e.createElement("button",{onClick:u,className:"flex-1 bg-red-600 px-6 py-2 rounded hover:bg-red-700 text-white"},"Deny Claim"),e.createElement("button",{onClick:f,className:"flex-1 bg-green-600 px-6 py-2 rounded hover:bg-green-700 text-white"},"Accept Claim")))):e.createElement("div",{className:"grid gap-4"},t.length===0?e.createElement("div",{className:"text-gray-400 text-center p-4"},"No pending profile claims"):t.map(a=>e.createElement("div",{key:a.submission.id,className:"bg-gray-800 p-4 rounded"},e.createElement("div",{className:"flex justify-between mb-2"},e.createElement("div",null,e.createElement("strong",{className:"text-white"},"Claimant: "),e.createElement("span",{className:"text-gray-300"},a.claimantProfile.full_name)),e.createElement("div",null,e.createElement("strong",{className:"text-white"},"Target: "),e.createElement("span",{className:"text-gray-300"},a.targetProfile.full_name))),e.createElement("button",{onClick:()=>{v(a),_(a.claimantProfile),r(a.targetProfile)},className:"bg-blue-600 px-4 py-2 rounded hover:bg-blue-700 text-white"},"Review")))))},$e=()=>{const[t,m]=c.useState("legacy"),[g,n]=c.useState(!1),[i,o]=c.useState(""),[h,v]=c.useState(null),[b,_]=c.useState([]),[d,r]=c.useState(!0),s=[{id:"legacy",label:"Legacy"},{id:"speed",label:"Speed"},{id:"traditional",label:"Traditional"},{id:"flair",label:"Flair"}],f={legacy:["rating","rating_rd","rating_volatility","ranking"],speed:["speed_rating","speed_rd","speed_volatility","speed_ranking"],traditional:["traditional_rating","traditional_rd","traditional_volatility","traditional_ranking"],flair:["flair_rating","flair_rd","flair_volatility","flair_ranking"]};e.useEffect(()=>{u()},[t]);const u=async()=>{try{const a=f[t],{data:N,error:k}=await w.from("bartenders").select(`
          id,
          full_name,
          ${a.join(",")}
        `).not("is_archived","eq",!0).order(a[3],{ascending:!0,nullsLast:!0});if(k)throw k;_(N||[])}catch(a){o(`Error fetching data: ${a.message}`)}finally{r(!1)}},p=async a=>{n(!0),o(`Resetting ${a} ratings...`);try{const{error:N}=await w.rpc("reset_and_recalculate_category_ratings",{p_category:a,p_process_immediately:!0,p_log_details:!1});if(N)throw N;o(`${a} ratings reset and recalculated successfully`),await u()}catch(N){o(`Error: ${N.message}`)}finally{n(!1)}},E=(a,N)=>{const k=t==="legacy"?"":`${t}_`;return a[`${k}${N}`]||0};return d?e.createElement("div",{className:"flex justify-center items-center h-64"},e.createElement("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"})):e.createElement("div",{className:"space-y-6"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("div",{className:"flex gap-2"},s.map(a=>e.createElement("button",{key:a.id,onClick:()=>m(a.id),className:`px-4 py-2 rounded-lg ${t===a.id?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`},a.label))),e.createElement("button",{onClick:()=>p(t),disabled:g,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50"},"Reset & Recalculate")),i&&e.createElement("div",{className:`p-4 rounded-lg ${i.includes("Error")?"bg-red-900/50 text-red-200":"bg-green-900/50 text-green-200"}`},i),e.createElement("div",{className:"bg-gray-800 rounded-lg overflow-hidden"},e.createElement("div",{className:"overflow-x-auto"},e.createElement("table",{className:"min-w-full divide-y divide-gray-700"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},"Rank"),e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},"Name"),e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},"Rating"),e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},"RD"),e.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},"Volatility"),e.createElement("th",{className:"px-4 py-3"}))),e.createElement("tbody",{className:"divide-y divide-gray-700"},b.map(a=>e.createElement(e.Fragment,{key:a.id},e.createElement("tr",null,e.createElement("td",{className:"px-4 py-3 text-sm text-gray-300"},E(a,"ranking")||"Unranked"),e.createElement("td",{className:"px-4 py-3 text-sm text-white"},a.full_name),e.createElement("td",{className:"px-4 py-3 text-sm text-white"},Math.round(E(a,"rating"))),e.createElement("td",{className:"px-4 py-3 text-sm text-white"},E(a,"rd").toFixed(1)),e.createElement("td",{className:"px-4 py-3 text-sm text-white"},E(a,"volatility").toFixed(3)),e.createElement("td",{className:"px-4 py-3 text-sm"},e.createElement("button",{onClick:()=>v(h===a.id?null:a.id),className:"text-blue-400 hover:text-blue-300"},h===a.id?"Hide":"History"))),h===a.id&&e.createElement("tr",null,e.createElement("td",{colSpan:"6",className:"px-4 py-4 bg-gray-900"},e.createElement(Ce,{bartenderId:a.id,category:t,showDetails:!0}))))))))))},Ae=()=>{const[t,m]=c.useState("results");c.useEffect(()=>{const n=()=>{const i=window.location.hash.slice(1);i&&m(i.toLowerCase())};return n(),window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[]);const g=()=>{switch(t){case"results":return e.createElement(ee,null);case"bartenders":return e.createElement(pe,null);case"organisers":return e.createElement(De,null);case"profile_claims":return e.createElement(qe,null);case"glicko_ratings":return e.createElement($e,null);default:return e.createElement(ee,null)}};return e.createElement("div",{className:"min-h-screen bg-gray-900 text-white p-4"},e.createElement("div",{className:"max-w-7xl mx-auto"},e.createElement("h1",{className:"text-4xl font-bold mb-8"},"Admin Dashboard"),e.createElement(me,{activeTab:t,onTabChange:m}),g()))};document.addEventListener("DOMContentLoaded",async()=>{ne(),le(),oe(document.getElementById("admin-root")).render(e.createElement(Ae))});
